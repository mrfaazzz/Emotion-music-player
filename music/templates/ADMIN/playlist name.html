{#<!DOCTYPE html>#}
{#<html lang="en">#}
{#<head>#}
{#    <meta charset="UTF-8">#}
{#    <meta name="viewport" content="width=device-width, initial-scale=1.0">#}
{#    <title>Spotify-Like Music Player</title>#}
{#    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">#}
{#    <!-- Include ColorThief library -->#}
{#    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>#}
{#    <style>#}
{#        * {#}
{#            margin: 0;#}
{#            padding: 0;#}
{#            box-sizing: border-box;#}
{#            font-family: 'Circular', Arial, sans-serif;#}
{#        }#}
{#        body {#}
{#            background: #0f0f0f;#}
{#            color: #e0e0e0;#}
{#        }#}
{#        .spotify-container {#}
{#            display: flex;#}
{#            height: 100vh;#}
{#        }#}
{#        .main-content {#}
{#            flex-grow: 1;#}
{#            background: linear-gradient(180deg, #1a1a2e 0%, #0f0f0f 100%); /* Default gradient */#}
{#            overflow-y: auto;#}
{#            padding: 32px;#}
{#            transition: background 0.5s ease; /* Smooth transition for background */#}
{#        }#}
{#        .nav-bar {#}
{#            display: flex;#}
{#            justify-content: flex-start;#}
{#            padding: 12px 20px;#}
{#            background: rgba(20, 20, 20, 0.8);#}
{#            border-radius: 12px;#}
{#            margin-bottom: 32px;#}
{#            backdrop-filter: blur(12px);#}
{#        }#}
{#        .nav-button {#}
{#            background: rgba(255, 255, 255, 0.05);#}
{#            border: none;#}
{#            border-radius: 50%;#}
{#            width: 40px;#}
{#            height: 40px;#}
{#            color: #a0a0a0;#}
{#            cursor: pointer;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .nav-button:hover {#}
{#            background: rgba(255, 255, 255, 0.15);#}
{#            color: #fff;#}
{#        }#}
{#        .playlist-header {#}
{#            display: flex;#}
{#            align-items: center;#}
{#            gap: 28px;#}
{#            margin-bottom: 32px;#}
{#            padding: 28px;#}
{#            background: linear-gradient(135deg, #16213e 0%, #0f0f0f 100%); /* Default gradient */#}
{#            border-radius: 12px;#}
{#            transition: background 0.5s ease; /* Smooth transition for header */#}
{#        }#}
{#        .playlist-cover {#}
{#            width: 200px;#}
{#            height: 200px;#}
{#            border-radius: 10px;#}
{#            object-fit: cover;#}
{#            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);#}
{#        }#}
{#        .playlist-info {#}
{#            flex: 1;#}
{#        }#}
{#        .playlist-info h1 {#}
{#            font-size: 42px;#}
{#            font-weight: 800;#}
{#            margin-bottom: 12px;#}
{#            color: #fff;#}
{#        }#}
{#        .playlist-controls {#}
{#            display: flex;#}
{#            gap: 16px;#}
{#            padding: 0 28px;#}
{#            margin-bottom: 24px;#}
{#        }#}
{#        .play-button {#}
{#            background: #2ecc71;#}
{#            border: none;#}
{#            border-radius: 28px;#}
{#            color: #fff;#}
{#            padding: 12px 28px;#}
{#            font-size: 16px;#}
{#            font-weight: 600;#}
{#            display: flex;#}
{#            align-items: center;#}
{#            gap: 8px;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .play-button:hover {#}
{#            background: #27ae60;#}
{#            transform: scale(1.03);#}
{#        }#}
{#        .add-song-button {#}
{#            background: transparent;#}
{#            border: 2px solid #2ecc71;#}
{#            border-radius: 28px;#}
{#            color: #2ecc71;#}
{#            padding: 10px 28px;#}
{#            font-size: 16px;#}
{#            font-weight: 600;#}
{#            display: flex;#}
{#            align-items: center;#}
{#            gap: 8px;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .add-song-button:hover {#}
{#            background: rgba(46, 204, 113, 0.1);#}
{#            color: #27ae60;#}
{#        }#}
{#        .tracks-container {#}
{#            background: rgba(20, 20, 20, 0.7);#}
{#            border-radius: 12px;#}
{#            overflow: hidden;#}
{#        }#}
{#        .track-header, .track {#}
{#            display: grid;#}
{#            grid-template-columns: 40px 4fr 3fr 2fr 1fr;#}
{#            padding: 16px 24px;#}
{#            font-size: 14px;#}
{#            border-bottom: 1px solid rgba(255, 255, 255, 0.05);#}
{#        }#}
{#        .track-header {#}
{#            background: rgba(30, 30, 30, 0.9);#}
{#            color: #a0a0a0;#}
{#            font-weight: 600;#}
{#        }#}
{#        .track {#}
{#            color: #e0e0e0;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .track:hover {#}
{#            background: rgba(255, 255, 255, 0.05);#}
{#        }#}
{#        .track-actions {#}
{#            display: flex;#}
{#            gap: 12px;#}
{#        }#}
{#        .add-to-playlist-btn {#}
{#            background: transparent;#}
{#            border: 1px solid #2ecc71;#}
{#            border-radius: 50%;#}
{#            color: #2ecc71;#}
{#            width: 32px;#}
{#            height: 32px;#}
{#            display: flex;#}
{#            align-items: center;#}
{#            justify-content: center;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .add-to-playlist-btn:hover {#}
{#            background: #2ecc71;#}
{#            color: #fff;#}
{#        }#}
{#        .delete-playlist-btn {#}
{#            background: transparent;#}
{#            border: 1px solid #e74c3c;#}
{#            border-radius: 50%;#}
{#            color: #e74c3c;#}
{#            width: 32px;#}
{#            height: 32px;#}
{#            display: flex;#}
{#            align-items: center;#}
{#            justify-content: center;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .delete-playlist-btn:hover {#}
{#            background: #e74c3c;#}
{#            color: #fff;#}
{#        }#}
{#        .button-tooltip {#}
{#            position: relative;#}
{#        }#}
{#        .button-tooltip:hover::after {#}
{#            content: attr(data-tooltip);#}
{#            position: absolute;#}
{#            bottom: 120%;#}
{#            left: 50%;#}
{#            transform: translateX(-50%);#}
{#            background: #2c2c2c;#}
{#            color: #fff;#}
{#            padding: 6px 12px;#}
{#            border-radius: 6px;#}
{#            font-size: 12px;#}
{#            z-index: 100;#}
{#        }#}
{#        .footer-player {#}
{#            position: fixed;#}
{#            bottom: 0;#}
{#            left: 0;#}
{#            width: 100%;#}
{#            background: #1a1a1a;#}
{#            padding: 10px 20px;#}
{#            border-top: 1px solid #333;#}
{#            display: flex;#}
{#            align-items: center;#}
{#            justify-content: space-between;#}
{#            z-index: 100;#}
{#        }#}
{#        .footer-player img {#}
{#            width: 40px;#}
{#            height: 40px;#}
{#            border-radius: 4px;#}
{#            margin-right: 10px;#}
{#        }#}
{#        .footer-player .song-info {#}
{#            flex: 1;#}
{#            font-size: 14px;#}
{#        }#}
{#        .footer-player .song-info .song-title {#}
{#            color: #fff;#}
{#            font-weight: 500;#}
{#        }#}
{#        .footer-player .song-info .artist-name {#}
{#            color: #a0a0a0;#}
{#            font-size: 12px;#}
{#        }#}
{#        .footer-player .controls {#}
{#            display: flex;#}
{#            gap: 15px;#}
{#        }#}
{#        .footer-player button {#}
{#            background: none;#}
{#            border: none;#}
{#            color: #a0a0a0;#}
{#            font-size: 18px;#}
{#            cursor: pointer;#}
{#            transition: color 0.3s ease;#}
{#        }#}
{#        .footer-player button:hover {#}
{#            color: #fff;#}
{#        }#}
{#        .footer-player .play-pause {#}
{#            color: #2ecc71;#}
{#            font-size: 24px;#}
{#        }#}
{#        .modal {#}
{#            display: none;#}
{#            position: fixed;#}
{#            top: 0;#}
{#            left: 0;#}
{#            width: 100%;#}
{#            height: 100%;#}
{#            background: rgba(0, 0, 0, 0.8);#}
{#            z-index: 1000;#}
{#            align-items: center;#}
{#            justify-content: center;#}
{#        }#}
{#        .modal-content {#}
{#            background: #1a1a2e;#}
{#            padding: 24px;#}
{#            border-radius: 12px;#}
{#            width: 90%;#}
{#            max-width: 600px;#}
{#            max-height: 85vh;#}
{#            overflow-y: auto;#}
{#            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);#}
{#            animation: modalFadeIn 0.3s ease;#}
{#        }#}
{#        @keyframes modalFadeIn {#}
{#            from { opacity: 0; transform: translateY(-30px); }#}
{#            to { opacity: 1; transform: translateY(0); }#}
{#        }#}
{#        .modal-header {#}
{#            display: flex;#}
{#            justify-content: space-between;#}
{#            align-items: center;#}
{#            margin-bottom: 24px;#}
{#        }#}
{#        .modal-header h2 {#}
{#            color: #fff;#}
{#            font-size: 24px;#}
{#            font-weight: 700;#}
{#        }#}
{#        .close-modal {#}
{#            background: none;#}
{#            border: none;#}
{#            color: #a0a0a0;#}
{#            font-size: 28px;#}
{#            cursor: pointer;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .close-modal:hover {#}
{#            color: #fff;#}
{#        }#}
{#        .search-box {#}
{#            display: flex;#}
{#            align-items: center;#}
{#            background: #2c2c2c;#}
{#            border-radius: 8px;#}
{#            padding: 0 12px;#}
{#            margin-bottom: 20px;#}
{#        }#}
{#        .search-box input {#}
{#            background: transparent;#}
{#            border: none;#}
{#            padding: 12px 0;#}
{#            color: #e0e0e0;#}
{#            width: 100%;#}
{#            font-size: 14px;#}
{#        }#}
{#        .search-box input:focus {#}
{#            outline: none;#}
{#        }#}
{#        .search-icon {#}
{#            color: #a0a0a0;#}
{#            font-size: 16px;#}
{#            margin-right: 8px;#}
{#        }#}
{#        .select-all-container {#}
{#            display: flex;#}
{#            align-items: center;#}
{#            padding: 12px 0;#}
{#        }#}
{#        .select-all-label {#}
{#            margin-left: 12px;#}
{#            color: #a0a0a0;#}
{#            font-weight: 500;#}
{#        }#}
{#        .song-selection-list {#}
{#            max-height: 320px;#}
{#            overflow-y: auto;#}
{#            background: #2c2c2c;#}
{#            border-radius: 8px;#}
{#        }#}
{#        .song-selection-item {#}
{#            display: flex;#}
{#            align-items: center;#}
{#            padding: 12px 16px;#}
{#            border-bottom: 1px solid rgba(255, 255, 255, 0.05);#}
{#            cursor: pointer;#}
{#            transition: background 0.3s ease;#}
{#        }#}
{#        .song-selection-item:hover {#}
{#            background: rgba(46, 204, 113, 0.1);#}
{#        }#}
{#        .song-selection-details {#}
{#            flex-grow: 1;#}
{#            margin-left: 12px;#}
{#            cursor: pointer;#}
{#        }#}
{#        .song-selection-title {#}
{#            font-weight: 600;#}
{#            color: #fff;#}
{#            display: block;#}
{#        }#}
{#        .song-selection-artist {#}
{#            color: #a0a0a0;#}
{#            font-size: 13px;#}
{#        }#}
{#        .song-checkbox {#}
{#            width: 18px;#}
{#            height: 18px;#}
{#            margin-right: 12px;#}
{#            accent-color: #2ecc71;#}
{#            cursor: pointer;#}
{#        }#}
{#        .modal-footer {#}
{#            margin-top: 24px;#}
{#            display: flex;#}
{#            justify-content: space-between;#}
{#            align-items: center;#}
{#        }#}
{#        .modal-actions {#}
{#            display: flex;#}
{#            gap: 12px;#}
{#        }#}
{#        .modal-cancel-btn {#}
{#            background: transparent;#}
{#            border: 1px solid #a0a0a0;#}
{#            border-radius: 28px;#}
{#            color: #a0a0a0;#}
{#            padding: 10px 24px;#}
{#            font-size: 16px;#}
{#            font-weight: 600;#}
{#            cursor: pointer;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .modal-cancel-btn:hover {#}
{#            background: rgba(255, 255, 255, 0.1);#}
{#            color: #fff;#}
{#        }#}
{#        .modal-add-btn {#}
{#            background: #2ecc71;#}
{#            border: none;#}
{#            border-radius: 28px;#}
{#            color: #fff;#}
{#            padding: 10px 24px;#}
{#            font-size: 16px;#}
{#            font-weight: 600;#}
{#            cursor: pointer;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .modal-add-btn:hover {#}
{#            background: #27ae60;#}
{#        }#}
{#        .modal-add-btn:disabled {#}
{#            background: #a0a0a0;#}
{#            cursor: not-allowed;#}
{#        }#}
{#        .selected-songs-count {#}
{#            color: #2ecc71;#}
{#            font-size: 14px;#}
{#            font-weight: 600;#}
{#        }#}
{#        .message-display {#}
{#            padding: 10px;#}
{#            margin-bottom: 20px;#}
{#            text-align: center;#}
{#            display: none;#}
{#        }#}
{#        .message-display.success {#}
{#            color: #2ecc71;#}
{#        }#}
{#        .message-display.error {#}
{#            color: #e74c3c;#}
{#        }#}
{#    </style>#}
{#</head>#}
{#<body>#}
{#    <div class="main-content">#}
{#        <div class="nav-bar">#}
{#            <button class="nav-button" id="back-button" title="Go back">#}
{#                <i class="fas fa-chevron-left"></i>#}
{#            </button>#}
{#        </div>#}
{##}
{#        <div class="message-display" id="message-display"></div>#}
{##}
{#        <div class="playlist-header">#}
{#            <img src="{{ data.song.simage.url }}" alt="Playlist Cover" class="playlist-cover" id="playlist-cover-img">#}
{#            <div class="playlist-info">#}
{#                <h1>{{ data.pname }}</h1>#}
{#                <p>Emotion: {{ emotion }}</p>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <div class="playlist-controls">#}
{#            <button class="play-button" id="play-all-btn">#}
{#                <i class="fas fa-play"></i>#}
{#                Play#}
{#            </button>#}
{#            <button class="add-song-button" id="open-add-song-modal">#}
{#                <i class="fas fa-plus"></i>#}
{#                Add#}
{#            </button>#}
{#        </div>#}
{##}
{#        <div class="tracks-container">#}
{#            <div class="track-header">#}
{#                <div>#</div>#}
{#                <div>Title</div>#}
{#                <div>Emotion</div>#}
{#                <div>Duration</div>#}
{#                <div>Actions</div>#}
{#            </div>#}
{#            <div id="tracks-list">#}
{#                {% for song in aa %}#}
{#                <div class="track">#}
{#                    <div class="track-number">{{ forloop.counter }}</div>#}
{#                    <div class="track-title">{{ song.sname.sname }}</div>#}
{#                    <div class="track-emotion">{{ song.sname.emotion }}</div>#}
{#                    <div class="track-duration">{{ song.sname.duration }}</div>#}
{#                    <div class="track-actions">#}
{#                        <button class="add-to-playlist-btn button-tooltip" data-tooltip="Play" data-index="{{ forloop.counter0 }}">#}
{#                            <i class="fas fa-play"></i>#}
{#                        </button>#}
{#                        <a href="{% url 'playlistsong_delete' song.id %}"#}
{#                           class="delete-playlist-btn button-tooltip"#}
{#                           data-tooltip="Delete"#}
{#                           onclick="return confirm('Are you sure you want to delete this song from the playlist?');">#}
{#                            <i class="fas fa-trash-alt"></i>#}
{#                        </a>#}
{#                    </div>#}
{#                </div>#}
{#                {% endfor %}#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="footer-player">#}
{#        <div class="song-info">#}
{#            <img id="track-cover" src="{{ data.song.simage.url }}" alt="Album Cover">#}
{#            <div>#}
{#                <span class="song-title" id="track-title">{{ data.song.sname }}</span>#}
{#                <br>#}
{#                <span class="artist-name" id="track-artist"></span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="controls">#}
{#            <button id="prev-btn"><i class="fas fa-step-backward"></i></button>#}
{#            <button class="play-pause" id="play-pause-btn"><i class="fas fa-play"></i></button>#}
{#            <button id="next-btn"><i class="fas fa-step-forward"></i></button>#}
{#        </div>#}
{#    </div>#}
{##}
{#    {% for song in aa %}#}
{#    <audio id="audio-player-{{ forloop.counter0 }}" class="audio-player">#}
{#        <source src="{{ song.song.url }}" type="audio/mpeg">#}
{#    </audio>#}
{#    {% endfor %}#}
{##}
{#    <!-- Add Song Popup Modal -->#}
{#    <form id="add-song-form" method="POST" action="{% url 'add_playlist_post' id=data.id %}">#}
{#        {% csrf_token %}#}
{#        <div id="add-song-modal" class="modal">#}
{#            <div class="modal-content">#}
{#                <div class="modal-header">#}
{#                    <h2>Add to playlist</h2>#}
{#                    <button type="button" class="close-modal" id="close-modal">×</button>#}
{#                </div>#}
{##}
{#                <div class="search-box">#}
{#                    <i class="fas fa-search search-icon"></i>#}
{#                    <input type="text" id="song-search" placeholder="Search songs by title or duration...">#}
{#                </div>#}
{##}
{#                <div class="select-all-container">#}
{#                    <input type="checkbox" id="select-all-checkbox" class="song-checkbox">#}
{#                    <label for="select-all-checkbox" class="select-all-label">Select All Visible Songs</label>#}
{#                </div>#}
{##}
{#                <div class="song-selection-list" id="song-selection-list">#}
{#                    {% for i in kk %}#}
{#                    <div class="song-selection-item" data-id="{{ i.id }}">#}
{#                        <input type="checkbox"#}
{#                               class="song-checkbox"#}
{#                               id="song-{{ i.id }}"#}
{#                               name="selected_songs"#}
{#                               value="{{ i.id }}">#}
{#                        <label for="song-{{ i.id }}" class="song-selection-details">#}
{#                            <span class="song-selection-title">{{ i.sname }}</span>#}
{#                            <span class="song-selection-artist">{{ i.duration }} • {{ i.emotion }}</span>#}
{#                        </label>#}
{#                    </div>#}
{#                    {% endfor %}#}
{#                </div>#}
{##}
{#                <div class="modal-footer">#}
{#                    <div class="selected-songs-count" id="selected-songs-count">0 songs selected</div>#}
{#                    <div class="modal-actions">#}
{#                        <button type="button" class="modal-cancel-btn" id="cancel-modal">Cancel</button>#}
{#                        <button type="submit" class="modal-add-btn" id="add-song-btn">Save</button>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </form>#}
{##}
{#    <script>#}
{#        document.addEventListener("DOMContentLoaded", function () {#}
{#            let currentSongIndex = 0;#}
{#            const audioPlayers = document.querySelectorAll(".audio-player");#}
{#            const numSongs = audioPlayers.length;#}
{##}
{#            const playPauseBtn = document.getElementById("play-pause-btn");#}
{#            const prevBtn = document.getElementById("prev-btn");#}
{#            const nextBtn = document.getElementById("next-btn");#}
{#            const playAllBtn = document.getElementById("play-all-btn");#}
{#            const trackPlayBtns = document.querySelectorAll(".add-to-playlist-btn");#}
{#            const backButton = document.getElementById("back-button");#}
{#            const modal = document.getElementById("add-song-modal");#}
{#            const openModalBtn = document.getElementById("open-add-song-modal");#}
{#            const closeModalBtn = document.getElementById("close-modal");#}
{#            const cancelModalBtn = document.getElementById("cancel-modal");#}
{#            const addSongForm = document.getElementById("add-song-form");#}
{#            const addSongBtn = document.getElementById("add-song-btn");#}
{#            const songCheckboxes = document.querySelectorAll(".song-checkbox:not(#select-all-checkbox)");#}
{#            const selectAllCheckbox = document.getElementById("select-all-checkbox");#}
{#            const songSearch = document.getElementById("song-search");#}
{#            const songSelectionItems = document.querySelectorAll(".song-selection-item");#}
{#            const selectedSongsCount = document.getElementById("selected-songs-count");#}
{#            const messageDisplay = document.getElementById("message-display");#}
{#            const playlistHeader = document.querySelector(".playlist-header");#}
{#            const mainContent = document.querySelector(".main-content");#}
{#            const playlistCoverImg = document.getElementById("playlist-cover-img");#}
{##}
{#            // Extract and apply dominant color from image#}
{#            const colorThief = new ColorThief();#}
{#            playlistCoverImg.onload = function() {#}
{#                const dominantColor = colorThief.getColor(playlistCoverImg);#}
{#                const rgbColor = `rgb(${dominantColor[0]}, ${dominantColor[1]}, ${dominantColor[2]})`;#}
{#                // Apply to playlist header#}
{#                playlistHeader.style.background = `linear-gradient(135deg, ${rgbColor} 0%, #0f0f0f 100%)`;#}
{#                // Apply to main content background#}
{#                mainContent.style.background = `linear-gradient(180deg, ${rgbColor} 0%, #0f0f0f 100%)`;#}
{#            };#}
{#            // Ensure the image is loaded if it's already cached#}
{#            if (playlistCoverImg.complete) {#}
{#                playlistCoverImg.onload();#}
{#            }#}
{##}
{#            // Main player controls#}
{#            backButton.addEventListener("click", () => window.history.back());#}
{##}
{#            playAllBtn.addEventListener("click", function() {#}
{#                if (numSongs > 0) {#}
{#                    currentSongIndex = 0;#}
{#                    playSong(currentSongIndex);#}
{#                }#}
{#            });#}
{##}
{#            trackPlayBtns.forEach(btn => {#}
{#                btn.addEventListener("click", function() {#}
{#                    currentSongIndex = parseInt(this.getAttribute("data-index"));#}
{#                    playSong(currentSongIndex);#}
{#                });#}
{#            });#}
{##}
{#            prevBtn.addEventListener("click", function() {#}
{#                currentSongIndex = (currentSongIndex > 0) ? currentSongIndex - 1 : numSongs - 1;#}
{#                playSong(currentSongIndex);#}
{#            });#}
{##}
{#            nextBtn.addEventListener("click", function() {#}
{#                currentSongIndex = (currentSongIndex < numSongs - 1) ? currentSongIndex + 1 : 0;#}
{#                playSong(currentSongIndex);#}
{#            });#}
{##}
{#            playPauseBtn.addEventListener("click", togglePlayPause);#}
{##}
{#            // Popup modal controls#}
{#            openModalBtn.addEventListener("click", openModal);#}
{#            closeModalBtn.addEventListener("click", closeModal);#}
{#            cancelModalBtn.addEventListener("click", closeModal);#}
{#            window.addEventListener("click", (e) => {#}
{#                if (e.target === modal) closeModal();#}
{#            });#}
{##}
{#            // AJAX form submission#}
{#            addSongForm.addEventListener("submit", function(e) {#}
{#                e.preventDefault();#}
{#                const formData = new FormData(this);#}
{##}
{#                fetch(this.action, {#}
{#                    method: 'POST',#}
{#                    body: formData,#}
{#                    headers: {#}
{#                        'X-Requested-With': 'XMLHttpRequest'#}
{#                    }#}
{#                })#}
{#                .then(response => {#}
{#                    const status = response.status;#}
{#                    return response.text().then(text => ({ status, text }));#}
{#                })#}
{#                .then(data => {#}
{#                    messageDisplay.style.display = 'block';#}
{#                    messageDisplay.textContent = data.text;#}
{##}
{#                    if (data.status === 201) {#}
{#                        messageDisplay.className = 'message-display success';#}
{#                        closeModal();#}
{#                        setTimeout(() => {#}
{#                            messageDisplay.style.display = 'none';#}
{#                            window.location.reload();#}
{#                        }, 2000);#}
{#                    } else {#}
{#                        messageDisplay.className = 'message-display error';#}
{#                        setTimeout(() => {#}
{#                            messageDisplay.style.display = 'none';#}
{#                        }, 3000);#}
{#                    }#}
{#                })#}
{#                .catch(error => {#}
{#                    messageDisplay.style.display = 'block';#}
{#                    messageDisplay.textContent = 'An error occurred!';#}
{#                    messageDisplay.className = 'message-display error';#}
{#                    setTimeout(() => {#}
{#                        messageDisplay.style.display = 'none';#}
{#                    }, 3000);#}
{#                });#}
{#            });#}
{##}
{#            songCheckboxes.forEach(checkbox => {#}
{#                checkbox.addEventListener("change", updateSelection);#}
{#            });#}
{##}
{#            songSelectionItems.forEach(item => {#}
{#                item.addEventListener("click", (e) => {#}
{#                    if (e.target.type !== 'checkbox') {#}
{#                        const checkbox = item.querySelector('.song-checkbox');#}
{#                        checkbox.checked = !checkbox.checked;#}
{#                        updateSelection();#}
{#                    }#}
{#                });#}
{#            });#}
{##}
{#            selectAllCheckbox.addEventListener("change", function() {#}
{#                const visibleItems = getVisibleItems();#}
{#                visibleItems.forEach(item => {#}
{#                    const checkbox = item.querySelector('.song-checkbox');#}
{#                    checkbox.checked = this.checked;#}
{#                });#}
{#                updateSelection();#}
{#            });#}
{##}
{#            songSearch.addEventListener("input", function() {#}
{#                const searchTerm = this.value.toLowerCase();#}
{#                songSelectionItems.forEach(item => {#}
{#                    const title = item.querySelector('.song-selection-title').textContent.toLowerCase();#}
{#                    const artist = item.querySelector('.song-selection-artist').textContent.toLowerCase();#}
{#                    item.style.display = (title.includes(searchTerm) || artist.includes(searchTerm)) ? "flex" : "none";#}
{#                });#}
{#                updateSelection();#}
{#            });#}
{##}
{#            function playSong(index) {#}
{#                audioPlayers.forEach((player, i) => {#}
{#                    player.pause();#}
{#                    if (i === index) {#}
{#                        player.currentTime = 0;#}
{#                        player.play();#}
{#                    }#}
{#                });#}
{#            }#}
{##}
{#            function togglePlayPause() {#}
{#                const currentPlayer = audioPlayers[currentSongIndex];#}
{#                if (currentPlayer.paused) {#}
{#                    currentPlayer.play();#}
{#                    playPauseBtn.querySelector('i').classList.replace('fa-play', 'fa-pause');#}
{#                } else {#}
{#                    currentPlayer.pause();#}
{#                    playPauseBtn.querySelector('i').classList.replace('fa-pause', 'fa-play');#}
{#                }#}
{#            }#}
{##}
{#            function openModal() {#}
{#                modal.style.display = "flex";#}
{#                songSearch.value = "";#}
{#                songCheckboxes.forEach(checkbox => checkbox.checked = false);#}
{#                selectAllCheckbox.checked = false;#}
{#                songSelectionItems.forEach(item => item.style.display = "flex");#}
{#                updateSelection();#}
{#                messageDisplay.style.display = 'none';#}
{#            }#}
{##}
{#            function closeModal() {#}
{#                modal.style.display = "none";#}
{#            }#}
{##}
{#            function updateSelection() {#}
{#                const visibleItems = getVisibleItems();#}
{#                const checkedCount = visibleItems.filter(item =>#}
{#                    item.querySelector('.song-checkbox').checked).length;#}
{##}
{#                selectedSongsCount.textContent = `${checkedCount} song${checkedCount === 1 ? '' : 's'} selected`;#}
{#                addSongBtn.disabled = checkedCount === 0;#}
{##}
{#                if (visibleItems.length > 0) {#}
{#                    if (checkedCount === visibleItems.length) {#}
{#                        selectAllCheckbox.checked = true;#}
{#                        selectAllCheckbox.indeterminate = false;#}
{#                    } else if (checkedCount > 0) {#}
{#                        selectAllCheckbox.checked = false;#}
{#                        selectAllCheckbox.indeterminate = true;#}
{#                    } else {#}
{#                        selectAllCheckbox.checked = false;#}
{#                        selectAllCheckbox.indeterminate = false;#}
{#                    }#}
{#                } else {#}
{#                    selectAllCheckbox.checked = false;#}
{#                    selectAllCheckbox.indeterminate = false;#}
{#                }#}
{#            }#}
{##}
{#            function getVisibleItems() {#}
{#                return Array.from(songSelectionItems).filter(item =>#}
{#                    window.getComputedStyle(item).display !== 'none');#}
{#            }#}
{#        });#}
{#    </script>#}
{#</body>#}
{#</html>#}



{#<!DOCTYPE html>#}
{#<html lang="en">#}
{#<head>#}
{#    <meta charset="UTF-8">#}
{#    <meta name="viewport" content="width=device-width, initial-scale=1.0">#}
{#    <title>Spotify-Like Music Player</title>#}
{#    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">#}
{#    <!-- Include ColorThief library -->#}
{#    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>#}
{#    <style>#}
{#        * {#}
{#            margin: 0;#}
{#            padding: 0;#}
{#            box-sizing: border-box;#}
{#            font-family: 'Circular', Arial, sans-serif;#}
{#        }#}
{#        body {#}
{#            background: #0f0f0f;#}
{#            color: #e0e0e0;#}
{#        }#}
{#        .back-btn {#}
{#            background: rgba(79, 79, 79, 0.85);#}
{#            border: none;#}
{#            padding: 10px 15px;#}
{#            border-radius: 50px;#}
{#            cursor: pointer;#}
{#            transition: background 0.2s;#}
{#        }#}
{##}
{#        .back-btn:hover {#}
{#            background: #404040;#}
{#        }#}
{##}
{#        .spotify-container {#}
{#            display: flex;#}
{#            height: 100vh;#}
{#        }#}
{#        .main-content {#}
{#            flex-grow: 1;#}
{#            background: linear-gradient(180deg, #1a1a2e 0%, #0f0f0f 100%); /* Default gradient */#}
{#            overflow-y: auto;#}
{#            padding: 32px;#}
{#            transition: background 0.5s ease; /* Smooth transition for background */#}
{#        }#}
{#        .nav-bar {#}
{#            display: flex;#}
{#            justify-content: flex-start;#}
{#            padding: 12px 20px;#}
{#            background: rgba(20, 20, 20, 0.8);#}
{#            border-radius: 12px;#}
{#            margin-bottom: 32px;#}
{#            backdrop-filter: blur(12px);#}
{#        }#}
{#        .nav-button {#}
{#            background: rgba(255, 255, 255, 0.05);#}
{#            border: none;#}
{#            border-radius: 50%;#}
{#            width: 40px;#}
{#            height: 40px;#}
{#            color: #a0a0a0;#}
{#            cursor: pointer;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .nav-button:hover {#}
{#            background: rgba(255, 255, 255, 0.15);#}
{#            color: #fff;#}
{#        }#}
{#        .playlist-header {#}
{#            display: flex;#}
{#            align-items: center;#}
{#            gap: 28px;#}
{#            margin-bottom: 32px;#}
{#            padding: 28px;#}
{#            background: linear-gradient(135deg, #16213e 0%, #0f0f0f 100%); /* Default gradient */#}
{#            border-radius: 12px;#}
{#            transition: background 0.5s ease; /* Smooth transition for header */#}
{#        }#}
{#        .playlist-cover {#}
{#            width: 200px;#}
{#            height: 200px;#}
{#            border-radius: 10px;#}
{#            object-fit: cover;#}
{#            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);#}
{#        }#}
{#        .playlist-info {#}
{#            flex: 1;#}
{#        }#}
{#        .playlist-info h1 {#}
{#            font-size: 42px;#}
{#            font-weight: 800;#}
{#            margin-bottom: 12px;#}
{#            color: #fff;#}
{#        }#}
{#        .playlist-controls {#}
{#            display: flex;#}
{#            gap: 16px;#}
{#            padding: 0 28px;#}
{#            margin-bottom: 24px;#}
{#        }#}
{#        .play-button {#}
{#            background: #2ecc71;#}
{#            border: none;#}
{#            border-radius: 28px;#}
{#            color: #fff;#}
{#            padding: 12px 28px;#}
{#            font-size: 16px;#}
{#            font-weight: 600;#}
{#            display: flex;#}
{#            align-items: center;#}
{#            gap: 8px;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .play-button:hover {#}
{#            background: #27ae60;#}
{#            transform: scale(1.03);#}
{#        }#}
{#        .add-song-button {#}
{#            background: transparent;#}
{#            border: 2px solid #2ecc71;#}
{#            border-radius: 28px;#}
{#            color: #2ecc71;#}
{#            padding: 10px 28px;#}
{#            font-size: 16px;#}
{#            font-weight: 600;#}
{#            display: flex;#}
{#            align-items: center;#}
{#            gap: 8px;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .add-song-button:hover {#}
{#            background: rgba(46, 204, 113, 0.1);#}
{#            color: #27ae60;#}
{#        }#}
{#        .tracks-container {#}
{#            background: rgba(20, 20, 20, 0.7);#}
{#            border-radius: 12px;#}
{#            overflow: hidden;#}
{#        }#}
{#        .track-header, .track {#}
{#            display: grid;#}
{#            grid-template-columns: 40px 4fr 3fr 2fr 1fr;#}
{#            padding: 16px 24px;#}
{#            font-size: 14px;#}
{#            border-bottom: 1px solid rgba(255, 255, 255, 0.05);#}
{#        }#}
{#        .track-header {#}
{#            background: rgba(30, 30, 30, 0.9);#}
{#            color: #a0a0a0;#}
{#            font-weight: 600;#}
{#        }#}
{#        .track {#}
{#            color: #e0e0e0;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .track:hover {#}
{#            background: rgba(255, 255, 255, 0.05);#}
{#        }#}
{#        .track-actions {#}
{#            display: flex;#}
{#            gap: 12px;#}
{#        }#}
{#        .add-to-playlist-btn {#}
{#            background: transparent;#}
{#            border: 1px solid #2ecc71;#}
{#            border-radius: 50%;#}
{#            color: #2ecc71;#}
{#            width: 32px;#}
{#            height: 32px;#}
{#            display: flex;#}
{#            align-items: center;#}
{#            justify-content: center;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .add-to-playlist-btn:hover {#}
{#            background: #2ecc71;#}
{#            color: #fff;#}
{#        }#}
{#        .delete-playlist-btn {#}
{#            background: transparent;#}
{#            border: 1px solid #e74c3c;#}
{#            border-radius: 50%;#}
{#            color: #e74c3c;#}
{#            width: 32px;#}
{#            height: 32px;#}
{#            display: flex;#}
{#            align-items: center;#}
{#            justify-content: center;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .delete-playlist-btn:hover {#}
{#            background: #e74c3c;#}
{#            color: #fff;#}
{#        }#}
{#        .button-tooltip {#}
{#            position: relative;#}
{#        }#}
{#        .button-tooltip:hover::after {#}
{#            content: attr(data-tooltip);#}
{#            position: absolute;#}
{#            bottom: 120%;#}
{#            left: 50%;#}
{#            transform: translateX(-50%);#}
{#            background: #2c2c2c;#}
{#            color: #fff;#}
{#            padding: 6px 12px;#}
{#            border-radius: 6px;#}
{#            font-size: 12px;#}
{#            z-index: 100;#}
{#        }#}
{#        .footer-player {#}
{#            position: fixed;#}
{#            bottom: 0;#}
{#            left: 0;#}
{#            width: 100%;#}
{#            background: #1a1a1a;#}
{#            padding: 10px 20px;#}
{#            border-top: 1px solid #333;#}
{#            display: flex;#}
{#            align-items: center;#}
{#            justify-content: space-between;#}
{#            z-index: 100;#}
{#        }#}
{#        .footer-player img {#}
{#            width: 40px;#}
{#            height: 40px;#}
{#            border-radius: 4px;#}
{#            margin-right: 10px;#}
{#        }#}
{#        .footer-player .song-info {#}
{#            flex: 1;#}
{#            font-size: 14px;#}
{#            display: flex;#}
{#            align-items: center;#}
{#        }#}
{#        .footer-player .song-info .song-title {#}
{#            color: #fff;#}
{#            font-weight: 500;#}
{#        }#}
{#        .footer-player .song-info .artist-name {#}
{#            color: #a0a0a0;#}
{#            font-size: 12px;#}
{#        }#}
{#        .footer-player .controls {#}
{#            display: flex;#}
{#            gap: 15px;#}
{#        }#}
{#        .footer-player button {#}
{#            background: none;#}
{#            border: none;#}
{#            color: #a0a0a0;#}
{#            font-size: 18px;#}
{#            cursor: pointer;#}
{#            transition: color 0.3s ease;#}
{#        }#}
{#        .footer-player button:hover {#}
{#            color: #fff;#}
{#        }#}
{#        .footer-player .play-pause {#}
{#            color: #2ecc71;#}
{#            font-size: 24px;#}
{#        }#}
{#        .modal {#}
{#            display: none;#}
{#            position: fixed;#}
{#            top: 0;#}
{#            left: 0;#}
{#            width: 100%;#}
{#            height: 100%;#}
{#            background: rgba(0, 0, 0, 0.8);#}
{#            z-index: 1000;#}
{#            align-items: center;#}
{#            justify-content: center;#}
{#        }#}
{#        .modal-content {#}
{#            background: #1a1a2e;#}
{#            padding: 24px;#}
{#            border-radius: 12px;#}
{#            width: 90%;#}
{#            max-width: 600px;#}
{#            max-height: 85vh;#}
{#            overflow-y: auto;#}
{#            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);#}
{#            animation: modalFadeIn 0.3s ease;#}
{#        }#}
{#        @keyframes modalFadeIn {#}
{#            from { opacity: 0; transform: translateY(-30px); }#}
{#            to { opacity: 1; transform: translateY(0); }#}
{#        }#}
{#        .modal-header {#}
{#            display: flex;#}
{#            justify-content: space-between;#}
{#            align-items: center;#}
{#            margin-bottom: 24px;#}
{#        }#}
{#        .modal-header h2 {#}
{#            color: #fff;#}
{#            font-size: 24px;#}
{#            font-weight: 700;#}
{#        }#}
{#        .close-modal {#}
{#            background: none;#}
{#            border: none;#}
{#            color: #a0a0a0;#}
{#            font-size: 28px;#}
{#            cursor: pointer;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .close-modal:hover {#}
{#            color: #fff;#}
{#        }#}
{#        .search-box {#}
{#            display: flex;#}
{#            align-items: center;#}
{#            background: #2c2c2c;#}
{#            border-radius: 8px;#}
{#            padding: 0 12px;#}
{#            margin-bottom: 20px;#}
{#        }#}
{#        .search-box input {#}
{#            background: transparent;#}
{#            border: none;#}
{#            padding: 12px 0;#}
{#            color: #e0e0e0;#}
{#            width: 100%;#}
{#            font-size: 14px;#}
{#        }#}
{#        .search-box input:focus {#}
{#            outline: none;#}
{#        }#}
{#        .search-icon {#}
{#            color: #a0a0a0;#}
{#            font-size: 16px;#}
{#            margin-right: 8px;#}
{#        }#}
{#        .select-all-container {#}
{#            display: flex;#}
{#            align-items: center;#}
{#            padding: 12px 0;#}
{#        }#}
{#        .select-all-label {#}
{#            margin-left: 12px;#}
{#            color: #a0a0a0;#}
{#            font-weight: 500;#}
{#        }#}
{#        .song-selection-list {#}
{#            max-height: 320px;#}
{#            overflow-y: auto;#}
{#            background: #2c2c2c;#}
{#            border-radius: 8px;#}
{#        }#}
{#        .song-selection-item {#}
{#            display: flex;#}
{#            align-items: center;#}
{#            padding: 12px 16px;#}
{#            border-bottom: 1px solid rgba(255, 255, 255, 0.05);#}
{#            cursor: pointer;#}
{#            transition: background 0.3s ease;#}
{#        }#}
{#        .song-selection-item:hover {#}
{#            background: rgba(46, 204, 113, 0.1);#}
{#        }#}
{#        .song-selection-details {#}
{#            flex-grow: 1;#}
{#            margin-left: 12px;#}
{#            cursor: pointer;#}
{#        }#}
{#        .song-selection-title {#}
{#            font-weight: 600;#}
{#            color: #fff;#}
{#            display: block;#}
{#        }#}
{#        .song-selection-artist {#}
{#            color: #a0a0a0;#}
{#            font-size: 13px;#}
{#        }#}
{#        .song-checkbox {#}
{#            width: 18px;#}
{#            height: 18px;#}
{#            margin-right: 12px;#}
{#            accent-color: #2ecc71;#}
{#            cursor: pointer;#}
{#        }#}
{#        .modal-footer {#}
{#            margin-top: 24px;#}
{#            display: flex;#}
{#            justify-content: space-between;#}
{#            align-items: center;#}
{#        }#}
{#        .modal-actions {#}
{#            display: flex;#}
{#            gap: 12px;#}
{#        }#}
{#        .modal-cancel-btn {#}
{#            background: transparent;#}
{#            border: 1px solid #a0a0a0;#}
{#            border-radius: 28px;#}
{#            color: #a0a0a0;#}
{#            padding: 10px 24px;#}
{#            font-size: 16px;#}
{#            font-weight: 600;#}
{#            cursor: pointer;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .modal-cancel-btn:hover {#}
{#            background: rgba(255, 255, 255, 0.1);#}
{#            color: #fff;#}
{#        }#}
{#        .modal-add-btn {#}
{#            background: #2ecc71;#}
{#            border: none;#}
{#            border-radius: 28px;#}
{#            color: #fff;#}
{#            padding: 10px 24px;#}
{#            font-size: 16px;#}
{#            font-weight: 600;#}
{#            cursor: pointer;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .modal-add-btn:hover {#}
{#            background: #27ae60;#}
{#        }#}
{#        .modal-add-btn:disabled {#}
{#            background: #a0a0a0;#}
{#            cursor: not-allowed;#}
{#        }#}
{#        .selected-songs-count {#}
{#            color: #2ecc71;#}
{#            font-size: 14px;#}
{#            font-weight: 600;#}
{#        }#}
{#        .message-display {#}
{#            padding: 10px;#}
{#            margin-bottom: 20px;#}
{#            text-align: center;#}
{#            display: none;#}
{#        }#}
{#        .message-display.success {#}
{#            color: #2ecc71;#}
{#        }#}
{#        .message-display.error {#}
{#            color: #e74c3c;#}
{#        }#}
{#        .currently-playing {#}
{#            background: rgba(46, 204, 113, 0.2) !important;#}
{#        }#}
{#    </style>#}
{#</head>#}
{#<body>#}
{#    <div class="spotify-container">#}
{#        <div class="main-content">#}
{#            <div class="nav-bar">#}
{#                 <button class="back-btn" onclick="history.back()">#}
{#        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">#}
{#            <path d="M15 18L9 12L15 6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>#}
{#        </svg>#}
{#    </button>#}
{#            </div>#}
{##}
{#            <div class="message-display" id="message-display"></div>#}
{##}
{#            <div class="playlist-header">#}
{#                <img src="{{ data.song.simage.url }}" alt="Playlist Cover" class="playlist-cover" id="playlist-cover-img">#}
{#                <div class="playlist-info">#}
{#                    <h1>{{ data.pname }}</h1>#}
{#                    <p>Emotion: {{ emotion }}</p>#}
{#                </div>#}
{#            </div>#}
{##}
{#            <div class="playlist-controls">#}
{#                <button class="play-button" id="play-all-btn">#}
{#                    <i class="fas fa-play"></i>#}
{#                    Play#}
{#                </button>#}
{#                <button class="add-song-button" id="open-add-song-modal">#}
{#                    <i class="fas fa-plus"></i>#}
{#                    Add#}
{#                </button>#}
{#            </div>#}
{##}
{#            <div class="tracks-container">#}
{#                <div class="track-header">#}
{#                    <div>#</div>#}
{#                    <div>Title</div>#}
{#                    <div>Emotion</div>#}
{#                    <div>Duration</div>#}
{#                    <div>Actions</div>#}
{#                </div>#}
{#                <div id="tracks-list">#}
{#                    {% for song in aa %}#}
{#                    <div class="track" data-index="{{ forloop.counter0 }}">#}
{#                        <div class="track-number">{{ forloop.counter }}</div>#}
{#                        <div class="track-title">{{ song.sname.sname }}</div>#}
{#                        <div class="track-emotion">{{ song.sname.emotion }}</div>#}
{#                        <div class="track-duration">{{ song.sname.duration }}</div>#}
{#                        <div class="track-actions">#}
{#                            <button class="add-to-playlist-btn button-tooltip" data-tooltip="Play" data-index="{{ forloop.counter0 }}" data-src="{{sname.song.url }}">#}
{#                                <i class="fas fa-play"></i>#}
{#                            </button>#}
{#                            <a href="{% url 'playlistsong_delete' song.id %}"#}
{#                               class="delete-playlist-btn button-tooltip"#}
{#                               data-tooltip="Delete"#}
{#                               onclick="return confirm('Are you sure you want to delete this song from the playlist?');">#}
{#                                <i class="fas fa-trash-alt"></i>#}
{#                            </a>#}
{#                        </div>#}
{#                    </div>#}
{#                    {% endfor %}#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <div class="footer-player">#}
{#        <div class="song-info">#}
{#            <img id="track-cover" src="{{ data.song.simage.url }}" alt="Album Cover">#}
{#            <div>#}
{#                <span class="song-title" id="track-title">{{ data.song.sname }}</span>#}
{#                <br>#}
{#                <span class="artist-name" id="track-artist"></span>#}
{#            </div>#}
{#        </div>#}
{#        <div class="controls">#}
{#            <button id="prev-btn"><i class="fas fa-step-backward"></i></button>#}
{#            <button class="play-pause" id="play-pause-btn"><i class="fas fa-play"></i></button>#}
{#            <button id="next-btn"><i class="fas fa-step-forward"></i></button>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Single audio player -->#}
{#    <audio id="audio-player" class="audio-player">#}
{#        <source src="" type="audio/mpeg">#}
{#        Your browser does not support the audio element.#}
{#    </audio>#}
{##}
{#    <!-- Add Song Popup Modal -->#}
{#    <form id="add-song-form" method="POST" action="{% url 'add_playlist_post' id=data.id %}">#}
{#        {% csrf_token %}#}
{#        <div id="add-song-modal" class="modal">#}
{#            <div class="modal-content">#}
{#                <div class="modal-header">#}
{#                    <h2>Add to playlist</h2>#}
{#                    <button type="button" class="close-modal" id="close-modal">×</button>#}
{#                </div>#}
{##}
{#                <div class="search-box">#}
{#                    <i class="fas fa-search search-icon"></i>#}
{#                    <input type="text" id="song-search" placeholder="Search songs by title or duration...">#}
{#                </div>#}
{##}
{#                <div class="select-all-container">#}
{#                    <input type="checkbox" id="select-all-checkbox" class="song-checkbox">#}
{#                    <label for="select-all-checkbox" class="select-all-label">Select All Visible Songs</label>#}
{#                </div>#}
{##}
{#                <div class="song-selection-list" id="song-selection-list">#}
{#                    {% for i in kk %}#}
{#                    <div class="song-selection-item" data-id="{{ i.id }}">#}
{#                        <input type="checkbox"#}
{#                               class="song-checkbox"#}
{#                               id="song-{{ i.id }}"#}
{#                               name="selected_songs"#}
{#                               value="{{ i.id }}">#}
{#                        <label for="song-{{ i.id }}" class="song-selection-details">#}
{#                            <span class="song-selection-title">{{ i.sname }}</span>#}
{#                            <span class="song-selection-artist">{{ i.duration }} • {{ i.emotion }}</span>#}
{#                        </label>#}
{#                    </div>#}
{#                    {% endfor %}#}
{#                </div>#}
{##}
{#                <div class="modal-footer">#}
{#                    <div class="selected-songs-count" id="selected-songs-count">0 songs selected</div>#}
{#                    <div class="modal-actions">#}
{#                        <button type="button" class="modal-cancel-btn" id="cancel-modal">Cancel</button>#}
{#                        <button type="submit" class="modal-add-btn" id="add-song-btn">Save</button>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </form>#}
{#<script>#}
{#document.addEventListener("DOMContentLoaded", function () {#}
{#    let currentSongIndex = 0;#}
{#    let isPlaying = false;#}
{##}
{#    // Get DOM elements#}
{#    const audioPlayer = document.getElementById("audio-player");#}
{#    const playPauseBtn = document.getElementById("play-pause-btn");#}
{#    const prevBtn = document.getElementById("prev-btn");#}
{#    const nextBtn = document.getElementById("next-btn");#}
{#    const playAllBtn = document.getElementById("play-all-btn");#}
{#    const trackTitle = document.getElementById("track-title");#}
{#    const trackArtist = document.getElementById("track-artist");#}
{#    const trackCover = document.getElementById("track-cover");#}
{#    const tracksContainer = document.getElementById("tracks-list");#}
{#    const trackPlayBtns = document.querySelectorAll(".add-to-playlist-btn");#}
{#    const tracks = tracksContainer ? tracksContainer.querySelectorAll(".track") : [];#}
{#    const numSongs = trackPlayBtns.length;#}
{##}
{#    // Modal elements#}
{#    const openAddSongModal = document.getElementById("open-add-song-modal");#}
{#    const addSongModal = document.getElementById("add-song-modal");#}
{#    const closeModal = document.getElementById("close-modal");#}
{#    const cancelModal = document.getElementById("cancel-modal");#}
{#    const songSearch = document.getElementById("song-search");#}
{#    const selectAllCheckbox = document.getElementById("select-all-checkbox");#}
{#    const songSelectionItems = document.querySelectorAll(".song-selection-item");#}
{#    const songCheckboxes = document.querySelectorAll(".song-checkbox");#}
{#    const selectedSongsCount = document.getElementById("selected-songs-count");#}
{##}
{#    if (!audioPlayer) {#}
{#        console.error("Audio player element not found!");#}
{#        return;#}
{#    }#}
{##}
{#    // Add ended event listener to audio player#}
{#    audioPlayer.addEventListener("ended", function() {#}
{#        // Play next song when current song ends#}
{#        currentSongIndex = (currentSongIndex < numSongs - 1) ? currentSongIndex + 1 : 0;#}
{#        playSongFromIndex(currentSongIndex);#}
{#    });#}
{##}
{#    // Event listeners for play buttons#}
{#    trackPlayBtns.forEach((btn, index) => {#}
{#        btn.addEventListener("click", function () {#}
{#            const songSrc = this.getAttribute("data-src");#}
{#            alert(songSrc);#}
{#            if (songSrc) {#}
{#                currentSongIndex = index;#}
{#                playSong(songSrc, index);#}
{#            } else {#}
{#                showMessage("No valid song source found!", "error");#}
{#            }#}
{#        });#}
{#    });#}
{##}
{#    if (playAllBtn) {#}
{#        playAllBtn.addEventListener("click", function () {#}
{#            if (numSongs > 0) {#}
{#                currentSongIndex = 0;#}
{#                playSongFromIndex(currentSongIndex);#}
{#            } else {#}
{#                showMessage("No songs available in this playlist", "error");#}
{#            }#}
{#        });#}
{#    }#}
{##}
{#    if (prevBtn) {#}
{#        prevBtn.addEventListener("click", function () {#}
{#            currentSongIndex = (currentSongIndex > 0) ? currentSongIndex - 1 : numSongs - 1;#}
{#            playSongFromIndex(currentSongIndex);#}
{#        });#}
{#    }#}
{##}
{#    if (nextBtn) {#}
{#        nextBtn.addEventListener("click", function () {#}
{#            currentSongIndex = (currentSongIndex < numSongs - 1) ? currentSongIndex + 1 : 0;#}
{#            playSongFromIndex(currentSongIndex);#}
{#        });#}
{#    }#}
{##}
{#    if (playPauseBtn) {#}
{#        playPauseBtn.addEventListener("click", togglePlayPause);#}
{#    }#}
{##}
{#    // Modal event listeners#}
{#    if (openAddSongModal && addSongModal) {#}
{#        openAddSongModal.addEventListener("click", function() {#}
{#            addSongModal.style.display = "flex";#}
{#        });#}
{#    }#}
{##}
{#    if (closeModal && addSongModal) {#}
{#        closeModal.addEventListener("click", function() {#}
{#            addSongModal.style.display = "none";#}
{#        });#}
{#    }#}
{##}
{#    if (cancelModal && addSongModal) {#}
{#        cancelModal.addEventListener("click", function() {#}
{#            addSongModal.style.display = "none";#}
{#        });#}
{#    }#}
{##}
{#    // Search functionality#}
{#    if (songSearch && songSelectionItems) {#}
{#        songSearch.addEventListener("input", function() {#}
{#            const searchTerm = this.value.toLowerCase();#}
{##}
{#            songSelectionItems.forEach(item => {#}
{#                const title = item.querySelector(".song-selection-title").textContent.toLowerCase();#}
{#                const artist = item.querySelector(".song-selection-artist").textContent.toLowerCase();#}
{##}
{#                if (title.includes(searchTerm) || artist.includes(searchTerm)) {#}
{#                    item.style.display = "";#}
{#                } else {#}
{#                    item.style.display = "none";#}
{#                }#}
{#            });#}
{#        });#}
{#    }#}
{##}
{#    // Select all functionality#}
{#    if (selectAllCheckbox && songCheckboxes) {#}
{#        selectAllCheckbox.addEventListener("change", function() {#}
{#            const visibleCheckboxes = Array.from(songCheckboxes).filter(checkbox =>#}
{#                checkbox.closest(".song-selection-item") &&#}
{#                checkbox.closest(".song-selection-item").style.display !== "none" &&#}
{#                checkbox !== selectAllCheckbox#}
{#            );#}
{##}
{#            visibleCheckboxes.forEach(checkbox => {#}
{#                checkbox.checked = selectAllCheckbox.checked;#}
{#            });#}
{##}
{#            updateSelectedCount();#}
{#        });#}
{##}
{#        songCheckboxes.forEach(checkbox => {#}
{#            if (checkbox !== selectAllCheckbox) {#}
{#                checkbox.addEventListener("change", updateSelectedCount);#}
{#            }#}
{#        });#}
{#    }#}
{##}
{#    function updateSelectedCount() {#}
{#        if (!selectedSongsCount) return;#}
{##}
{#        const checkedCount = Array.from(songCheckboxes)#}
{#            .filter(checkbox => checkbox !== selectAllCheckbox && checkbox.checked)#}
{#            .length;#}
{##}
{#        selectedSongsCount.textContent = checkedCount + " songs selected";#}
{#    }#}
{##}
{#    // Play selected song#}
{#    function playSong(songSrc, index) {#}
{#        if (!audioPlayer) return;#}
{##}
{#        audioPlayer.src = songSrc;#}
{#        audioPlayer.play()#}
{#            .then(() => {#}
{#                isPlaying = true;#}
{#                updatePlayerUI();#}
{#                updateSongInfo(index);#}
{#                highlightCurrentTrack(index);#}
{#            })#}
{#            .catch(err => {#}
{#                console.error("Error playing audio:", err);#}
{#                showMessage("Error playing audio: " + err.message, "error");#}
{#            });#}
{#    }#}
{##}
{#    // Play song from list index#}
{#    function playSongFromIndex(index) {#}
{#        const btn = trackPlayBtns[index];#}
{#        if (btn) {#}
{#            const songSrc = btn.getAttribute("data-src");#}
{#            if (songSrc) {#}
{#                playSong(songSrc, index);#}
{#            } else {#}
{#                showMessage("Song source not found", "error");#}
{#            }#}
{#        } else {#}
{#            showMessage("Play button not found", "error");#}
{#        }#}
{#    }#}
{##}
{#    function togglePlayPause() {#}
{#        if (!audioPlayer) return;#}
{##}
{#        if (audioPlayer.paused) {#}
{#            audioPlayer.play()#}
{#                .then(() => {#}
{#                    isPlaying = true;#}
{#                    updatePlayerUI();#}
{#                })#}
{#                .catch(err => {#}
{#                    console.error("Error playing audio:", err);#}
{#                });#}
{#        } else {#}
{#            audioPlayer.pause();#}
{#            isPlaying = false;#}
{#            updatePlayerUI();#}
{#        }#}
{#    }#}
{##}
{#    function updatePlayerUI() {#}
{#        if (!playPauseBtn) return;#}
{##}
{#        const icon = playPauseBtn.querySelector('i');#}
{#        if (icon) {#}
{#            icon.className = isPlaying ? "fas fa-pause" : "fas fa-play";#}
{#        }#}
{##}
{#        if (playAllBtn) {#}
{#            const playIcon = playAllBtn.querySelector('i');#}
{#            if (playIcon) {#}
{#                playIcon.className = isPlaying ? "fas fa-pause" : "fas fa-play";#}
{#            }#}
{#            const text = playAllBtn.childNodes[1];#}
{#            if (text && text.nodeType === Node.TEXT_NODE) {#}
{#                text.nodeValue = isPlaying ? " Pause" : " Play";#}
{#            }#}
{#        }#}
{#    }#}
{##}
{#    function updateSongInfo(index) {#}
{#        if (!tracks || tracks.length === 0 || index < 0 || index >= tracks.length) return;#}
{##}
{#        const track = tracks[index];#}
{#        const titleElement = track.querySelector(".track-title");#}
{#        const emotionElement = track.querySelector(".track-emotion");#}
{##}
{#        const title = titleElement ? titleElement.textContent : "Unknown";#}
{#        const emotion = emotionElement ? emotionElement.textContent : "";#}
{##}
{#        if (trackTitle) trackTitle.textContent = title;#}
{#        if (trackArtist) trackArtist.textContent = emotion;#}
{#    }#}
{##}
{#    function highlightCurrentTrack(index) {#}
{#        if (!tracks) return;#}
{##}
{#        tracks.forEach(track => {#}
{#            track.classList.remove("currently-playing");#}
{#        });#}
{##}
{#        if (index >= 0 && index < tracks.length) {#}
{#            tracks[index].classList.add("currently-playing");#}
{#        }#}
{#    }#}
{##}
{#    function showMessage(message, type) {#}
{#        const messageDisplay = document.getElementById("message-display");#}
{#        if (!messageDisplay) return;#}
{##}
{#        messageDisplay.textContent = message;#}
{#        messageDisplay.className = `message-display ${type}`;#}
{#        messageDisplay.style.display = "block";#}
{##}
{#        setTimeout(() => {#}
{#            messageDisplay.style.display = "none";#}
{#        }, 3000);#}
{#    }#}
{##}
{#    // Initialize with first song if available#}
{#    if (numSongs > 0) {#}
{#        updateSongInfo(0);#}
{#    }#}
{##}
{#    // Close modal when clicking outside#}
{#    window.addEventListener("click", function(event) {#}
{#        if (event.target === addSongModal) {#}
{#            addSongModal.style.display = "none";#}
{#        }#}
{#    });#}
{#{);#}
{#</script>#}
{#</body>#}
{#</html>#}




<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify-Like Music Player</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Include ColorThief library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Circular', Arial, sans-serif;
        }
        body {
            background: #0f0f0f;
            color: #e0e0e0;
        }
        .back-btn {
            background: rgba(79, 79, 79, 0.85);
            border: none;
            padding: 10px 15px;
            border-radius: 50px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .back-btn:hover {
            background: #404040;
        }

        .spotify-container {
            display: flex;
            height: 100vh;
        }
        .main-content {
            flex-grow: 1;
            background: linear-gradient(180deg, #1a1a2e 0%, #0f0f0f 100%); /* Default gradient */
            overflow-y: auto;
            padding: 32px;
            transition: background 0.5s ease; /* Smooth transition for background */
        }
        .nav-bar {
            display: flex;
            justify-content: flex-start;
            padding: 12px 20px;
            background: rgba(20, 20, 20, 0.8);
            border-radius: 12px;
            margin-bottom: 32px;
            backdrop-filter: blur(12px);
        }
        .playlist-header {
            display: flex;
            align-items: center;
            gap: 28px;
            margin-bottom: 32px;
            padding: 28px;
            background: linear-gradient(135deg, #16213e 0%, #0f0f0f 100%); /* Default gradient */
            border-radius: 12px;
            transition: background 0.5s ease; /* Smooth transition for header */
        }
        .playlist-cover {
            width: 200px;
            height: 200px;
            border-radius: 10px;
            object-fit: cover;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }
        .playlist-info {
            flex: 1;
        }
        .playlist-info h1 {
            font-size: 42px;
            font-weight: 800;
            margin-bottom: 12px;
            color: #fff;
        }
        .playlist-controls {
            display: flex;
            gap: 16px;
            padding: 0 28px;
            margin-bottom: 24px;
        }
        .play-button {
            background: #2ecc71;
            border: none;
            border-radius: 28px;
            color: #fff;
            padding: 12px 28px;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        .play-button:hover {
            background: #27ae60;
            transform: scale(1.03);
        }
        .add-song-button {
            background: transparent;
            border: 2px solid #2ecc71;
            border-radius: 28px;
            color: #2ecc71;
            padding: 10px 28px;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        .add-song-button:hover {
            background: rgba(46, 204, 113, 0.1);
            color: #27ae60;
        }
        .tracks-container {
            background: rgba(20, 20, 20, 0.7);
            border-radius: 12px;
            overflow: hidden;
        }
        .track-header, .track {
            display: grid;
            grid-template-columns: 40px 4fr 3fr 2fr 1fr;
            padding: 16px 24px;
            font-size: 14px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .track-header {
            background: rgba(30, 30, 30, 0.9);
            color: #a0a0a0;
            font-weight: 600;
        }
        .track {
            color: #e0e0e0;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .track:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        .track-actions {
            display: flex;
            gap: 12px;
        }
        .add-to-playlist-btn {
            background: transparent;
            border: 1px solid #2ecc71;
            border-radius: 50%;
            color: #2ecc71;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .add-to-playlist-btn:hover {
            background: #2ecc71;
            color: #fff;
        }
        .delete-playlist-btn {
            background: transparent;
            border: 1px solid #e74c3c;
            border-radius: 50%;
            color: #e74c3c;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        .delete-playlist-btn:hover {
            background: #e74c3c;
            color: #fff;
        }
        .button-tooltip {
            position: relative;
        }
        .button-tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 120%;
            left: 50%;
            transform: translateX(-50%);
            background: #2c2c2c;
            color: #fff;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            z-index: 100;
         }

/* Spotify-Themed Footer Player */
.footer-player {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #181818;
    padding: 10px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    z-index: 100;
    height: 90px;
    border-top: 1px solid #282828;
}

.footer-player img {
    width: 56px;
    height: 56px;
    margin-right: 14px;
    object-fit: cover;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

.footer-player .song-info {
    display: flex;
    align-items: center;
    width: 30%;
    min-width: 180px;
    cursor: pointer;
    padding: 8px;
    border-radius: 4px;
    transition: background 0.2s ease;
}

.footer-player .song-info:hover {
    background: #282828;
}

.footer-player .song-info .song-title {
    color: #fff;
    font-weight: 400;
    font-size: 14px;
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 150px;
}

.footer-player .song-info .artist-name {
    color: #b3b3b3;
    font-size: 11px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 150px;
}

.footer-player .controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
}

.footer-player button {
    background: none;
    border: none;
    color: #b3b3b3;
    font-size: 16px;
    cursor: pointer;
    transition: color 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.footer-player button:hover {
    color: #ffffff;
}

.footer-player .play-pause {
    background: #ffffff;
    color: #000;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s ease;
}

.footer-player .play-pause:hover {
    transform: scale(1.06);
    color: #000;
}

.progress-container {
    display: flex;
    align-items: center;
    flex: 1;
    margin: 0 20px;
    max-width: 40%;
}

.current-time, .total-time {
    color: #b3b3b3;
    font-size: 11px;
    width: 40px;
    text-align: center;
    font-weight: 400;
}

.progress-bar {
    flex: 1;
    height: 4px;
    background: #535353;
    border-radius: 2px;
    margin: 0 8px;
    position: relative;
    cursor: pointer;
}

.progress-bar:hover .progress-fill {
    background: #1DB954;
}

.progress-fill {
    position: absolute;
    left: 0;
    top: 0;
    height: 100%;
    background: #b3b3b3;
    border-radius: 2px;
}

/* Progress bar hover effect */
.progress-bar:hover {
    height: 4px;
}

.progress-bar:hover .progress-fill::after {
    content: '';
    position: absolute;
    right: -6px;
    top: 50%;
    transform: translateY(-50%);
    width: 12px;
    height: 12px;
    background: #1DB954;
    border-radius: 50%;
    display: block;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .footer-player {
        padding: 8px 12px;
    }

    .progress-container {
        margin: 0 10px;
    }
}

@media (max-width: 576px) {
    .footer-player .song-info {
        width: 30%;
        min-width: 120px;
    }

    .footer-player .controls {
        gap: 12px;
    }

    .progress-container {
        max-width: 35%;
    }
}
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: #1a1a2e;
            padding: 24px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            animation: modalFadeIn 0.3s ease;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .modal-header h2 {
            color: #fff;
            font-size: 24px;
            font-weight: 700;
        }
        .close-modal {
            background: none;
            border: none;
            color: #a0a0a0;
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .close-modal:hover {
            color: #fff;
        }
        .search-box {
            display: flex;
            align-items: center;
            background: #2c2c2c;
            border-radius: 8px;
            padding: 0 12px;
            margin-bottom: 20px;
        }
        .search-box input {
            background: transparent;
            border: none;
            padding: 12px 0;
            color: #e0e0e0;
            width: 100%;
            font-size: 14px;
        }
        .search-box input:focus {
            outline: none;
        }
        .search-icon {
            color: #a0a0a0;
            font-size: 16px;
            margin-right: 8px;
        }
        .select-all-container {
            display: flex;
            align-items: center;
            padding: 12px 0;
        }
        .select-all-label {
            margin-left: 12px;
            color: #a0a0a0;
            font-weight: 500;
        }
        .song-selection-list {
            max-height: 320px;
            overflow-y: auto;
            background: #2c2c2c;
            border-radius: 8px;
        }
        .song-selection-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: background 0.3s ease;
        }
        .song-selection-item:hover {
            background: rgba(46, 204, 113, 0.1);
        }
        .song-selection-details {
            flex-grow: 1;
            margin-left: 12px;
            cursor: pointer;
        }
        .song-selection-title {
            font-weight: 600;
            color: #fff;
            display: block;
        }
        .song-selection-artist {
            color: #a0a0a0;
            font-size: 13px;
        }
        .song-checkbox {
            width: 18px;
            height: 18px;
            margin-right: 12px;
            accent-color: #2ecc71;
            cursor: pointer;
        }
        .modal-footer {
            margin-top: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-actions {
            display: flex;
            gap: 12px;
        }
        .modal-cancel-btn {
            background: transparent;
            border: 1px solid #a0a0a0;
            border-radius: 28px;
            color: #a0a0a0;
            padding: 10px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .modal-cancel-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        .modal-add-btn {
            background: #2ecc71;
            border: none;
            border-radius: 28px;
            color: #fff;
            padding: 10px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .modal-add-btn:hover {
            background: #27ae60;
        }
        .modal-add-btn:disabled {
            background: #a0a0a0;
            cursor: not-allowed;
        }
        .selected-songs-count {
            color: #2ecc71;
            font-size: 14px;
            font-weight: 600;
        }

    </style>
</head>
<body>
    <div class="spotify-container">
        <div class="main-content">
            <div class="nav-bar">
    <button class="back-btn" onclick="window.location.href='{% url 'playlist' %}'">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 18L9 12L15 6" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </button>
</div>
            <div class="playlist-header">
                <img src="{{ data.song.simage.url }}" alt="Playlist Cover" class="playlist-cover" id="playlist-cover-img">
                <div class="playlist-info">
                    <h1>{{ data.pname }}</h1>
                    <p>Emotion: {{ emotion }}</p>
                </div>
            </div>

            <div class="playlist-controls">
                <button class="play-button" id="play-all-btn">
                    <i class="fas fa-play"></i>
                    Play
                </button>
                <button class="add-song-button" id="open-add-song-modal">
                    <i class="fas fa-plus"></i>
                    Add
                </button>
            </div>

            <div class="tracks-container">
                <div class="track-header">
                    <div>#</div>
                    <div>Title</div>
                    <div>Emotion</div>
                    <div>Duration</div>
                    <div>Actions</div>
                </div>
                <div id="tracks-list">
                    {% for song in aa %}
                    <div class="track" data-index="{{ forloop.counter0 }}" data-src="{{ song.sname.song.url }}">
                        <div class="track-number">{{ forloop.counter }}</div>
                        <div class="track-title">{{ song.sname.sname }}</div>
                        <div class="track-emotion">{{ song.sname.emotion }}</div>
                        <div class="track-duration">{{ song.sname.duration }}</div>
                        <div class="track-actions">
                            <button class="add-to-playlist-btn button-tooltip" data-tooltip="Play" data-index="{{ forloop.counter0 }}" data-src="{{ song.sname.song.url }}">
                                <i class="fas fa-play"></i>
                            </button>
                            <a href="{% url 'playlistsong_delete' song.id %}"
                               class="delete-playlist-btn button-tooltip"
                               data-tooltip="Delete"
                               onclick="return confirm('Are you sure you want to delete this song from the playlist?');">
                                <i class="fas fa-trash-alt"></i>
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>


    <div class="footer-player">
    <div class="song-info" id="footer-song-info">
        <img id="track-cover" src="{{ data.song.simage.url }}" alt="Album Cover">
        <div>
            <span class="song-title" id="track-title">{{ data.song.sname }}</span>
            <br>
            <span class="artist-name" id="track-artist"></span>
        </div>
    </div>
    <div class="controls">
        <button id="prev-btn"><i class="fas fa-step-backward"></i></button>
        <button class="play-pause" id="play-pause-btn"><i class="fas fa-play"></i></button>
        <button id="next-btn"><i class="fas fa-step-forward"></i></button>
    </div>
    <div class="progress-container">
        <span class="current-time">0:00</span>
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        <span class="total-time">0:00</span>
    </div>
</div>

    <!-- Single audio player -->
    <audio id="audio-player" class="audio-player">
        <source src="" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Add Song Popup Modal -->
    <form id="add-song-form" method="POST" action="{% url 'add_playlist_post' id=data.id %}">
        {% csrf_token %}
        <div id="add-song-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Add to playlist</h2>
                    <button type="button" class="close-modal" id="close-modal">×</button>
                </div>

                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="song-search" placeholder="Search songs by title or duration...">
                </div>

                <div class="select-all-container">
                    <input type="checkbox" id="select-all-checkbox" class="song-checkbox">
                    <label for="select-all-checkbox" class="select-all-label">Select All Visible Songs</label>
                </div>

                <div class="song-selection-list" id="song-selection-list">
                    {% for i in kk %}
                    <div class="song-selection-item" data-id="{{ i.id }}">
                        <input type="checkbox"
                               class="song-checkbox"
                               id="song-{{ i.id }}"
                               name="selected_songs"
                               value="{{ i.id }}">
                        <label for="song-{{ i.id }}" class="song-selection-details">
                            <span class="song-selection-title">{{ i.sname }}</span>
                            <span class="song-selection-artist">{{ i.duration }} • {{ i.emotion }}</span>
                        </label>
                    </div>
                    {% endfor %}
                </div>

                <div class="modal-footer">
                    <div class="selected-songs-count" id="selected-songs-count">0 songs selected</div>
                    <div class="modal-actions">
                        <button type="button" class="modal-cancel-btn" id="cancel-modal">Cancel</button>
                        <button type="submit" class="modal-add-btn" id="add-song-btn">Save</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <script>document.addEventListener("DOMContentLoaded", function () {
    let currentSongIndex = 0;
    let isPlaying = false;

    // Get DOM elements
    // First check if there's an existing audio element
    let audioPlayer = document.getElementById("audio-player");
    // If not, create one
    if (!audioPlayer) {
        audioPlayer = new Audio();
        audioPlayer.id = "audio-player";
        document.body.appendChild(audioPlayer);
    }

    const playPauseBtn = document.getElementById("play-pause-btn");
    const prevBtn = document.getElementById("prev-btn");
    const nextBtn = document.getElementById("next-btn");
    const playAllBtn = document.getElementById("play-all-btn");
    const trackTitle = document.getElementById("track-title");
    const trackArtist = document.getElementById("track-artist");
    const trackCover = document.getElementById("track-cover");
    const tracksContainer = document.getElementById("tracks-list");
    const trackPlayBtns = document.querySelectorAll(".add-to-playlist-btn");
    const tracks = tracksContainer ? tracksContainer.querySelectorAll(".track") : [];
    const currentTimeEl = document.querySelector('.current-time');
    const totalTimeEl = document.querySelector('.total-time');
    const progressBar = document.querySelector('.progress-bar');
    const progressFill = document.querySelector('.progress-fill');
    const numSongs = trackPlayBtns.length;

    // Modal elements
    const openAddSongModal = document.getElementById("open-add-song-modal");
    const addSongModal = document.getElementById("add-song-modal");
    const closeModal = document.getElementById("close-modal");
    const cancelModal = document.getElementById("cancel-modal");
    const songSearch = document.getElementById("song-search");
    const selectAllCheckbox = document.getElementById("select-all-checkbox");
    const songSelectionItems = document.querySelectorAll(".song-selection-item");
    const songCheckboxes = document.querySelectorAll(".song-checkbox");
    const selectedSongsCount = document.getElementById("selected-songs-count");

    console.log("Audio player initialized:", audioPlayer);
    console.log("Play/Pause button:", playPauseBtn);
    console.log("Number of tracks:", numSongs);

    // Add timeupdate event to update progress bar
    audioPlayer.addEventListener("timeupdate", function() {
        if (!isNaN(audioPlayer.duration)) {
            const percentage = (audioPlayer.currentTime / audioPlayer.duration) * 100;
            if (progressFill) {
                progressFill.style.width = `${percentage}%`;
            }
            if (currentTimeEl) {
                currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
            }
            if (totalTimeEl) {
                totalTimeEl.textContent = formatTime(audioPlayer.duration);
            }
        }
    });

    // Format time in minutes and seconds
    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }

    // Add ended event listener to audio player
    audioPlayer.addEventListener("ended", function() {
        console.log("Song ended, playing next");
        // Play next song when current song ends
        currentSongIndex = (currentSongIndex < numSongs - 1) ? currentSongIndex + 1 : 0;
        playSongFromIndex(currentSongIndex);
    });

    // Enable seeking on progress bar click
    if (progressBar) {
        progressBar.addEventListener("click", function(e) {
            const rect = progressBar.getBoundingClientRect();
            const clickPosition = e.clientX - rect.left;
            const percentage = clickPosition / rect.width;

            if (!isNaN(audioPlayer.duration)) {
                audioPlayer.currentTime = percentage * audioPlayer.duration;
                console.log("Seeking to:", percentage * audioPlayer.duration);
            }
        });
    }

    // Event listeners for play buttons in track list
    trackPlayBtns.forEach((btn, index) => {
        btn.addEventListener("click", function (e) {
            e.stopPropagation(); // Prevent track row click event from triggering
            const songSrc = this.getAttribute("data-src");
            if (songSrc) {
                console.log("Play button clicked, playing:", songSrc);
                currentSongIndex = index;
                playSong(songSrc, index);
            } else {
                showMessage("No valid song source found!", "error");
            }
        });
    });

    // Make entire track row clickable to play song
    tracks.forEach((track, index) => {
        track.addEventListener("click", function(e) {
            // Only trigger if not clicking on delete button or play button
            if (!e.target.closest('.delete-playlist-btn') && !e.target.closest('.add-to-playlist-btn')) {
                console.log("Track row clicked, index:", index);
                const playBtn = trackPlayBtns[index];
                if (playBtn) {
                    const songSrc = playBtn.getAttribute("data-src");
                    if (songSrc) {
                        currentSongIndex = index;
                        playSong(songSrc, index);
                    } else {
                        showMessage("No valid song source found!", "error");
                    }
                }
            }
        });
    });

    // Make the footer song info clickable to toggle play/pause
    const songInfoElement = document.querySelector(".song-info");
    if (songInfoElement) {
        songInfoElement.addEventListener("click", function() {
            console.log("Song info clicked, toggling play/pause");
            togglePlayPause();
        });
    }

    // Play All button functionality
    if (playAllBtn) {
        playAllBtn.addEventListener("click", function () {
            console.log("Play all button clicked");
            if (numSongs > 0) {
                currentSongIndex = 0;
                playSongFromIndex(currentSongIndex);
            } else {
                showMessage("No songs available in this playlist", "error");
            }
        });
    }

    // Previous button functionality
    if (prevBtn) {
        prevBtn.addEventListener("click", function () {
            console.log("Previous button clicked");
            currentSongIndex = (currentSongIndex > 0) ? currentSongIndex - 1 : numSongs - 1;
            playSongFromIndex(currentSongIndex);
        });
    }

    // Next button functionality
    if (nextBtn) {
        nextBtn.addEventListener("click", function () {
            console.log("Next button clicked");
            currentSongIndex = (currentSongIndex < numSongs - 1) ? currentSongIndex + 1 : 0;
            playSongFromIndex(currentSongIndex);
        });
    }

    // Play/Pause button functionality
    if (playPauseBtn) {
        playPauseBtn.addEventListener("click", function() {
            console.log("Play/Pause button clicked");
            togglePlayPause();
        });
    }

    // Modal event listeners
    if (openAddSongModal && addSongModal) {
        openAddSongModal.addEventListener("click", function() {
            addSongModal.style.display = "flex";
        });
    }

    if (closeModal && addSongModal) {
        closeModal.addEventListener("click", function() {
            addSongModal.style.display = "none";
        });
    }

    if (cancelModal && addSongModal) {
        cancelModal.addEventListener("click", function() {
            addSongModal.style.display = "none";
        });
    }

    // Search functionality
    if (songSearch && songSelectionItems) {
        songSearch.addEventListener("input", function() {
            const searchTerm = this.value.toLowerCase();

            songSelectionItems.forEach(item => {
                const title = item.querySelector(".song-selection-title").textContent.toLowerCase();
                const artist = item.querySelector(".song-selection-artist").textContent.toLowerCase();

                if (title.includes(searchTerm) || artist.includes(searchTerm)) {
                    item.style.display = "";
                } else {
                    item.style.display = "none";
                }
            });
        });
    }

    // Select all functionality
    if (selectAllCheckbox && songCheckboxes.length > 0) {
        selectAllCheckbox.addEventListener("change", function() {
            const visibleCheckboxes = Array.from(songCheckboxes).filter(checkbox =>
                checkbox.closest(".song-selection-item") &&
                checkbox.closest(".song-selection-item").style.display !== "none" &&
                checkbox !== selectAllCheckbox
            );

            visibleCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });

            updateSelectedCount();
        });

        songCheckboxes.forEach(checkbox => {
            if (checkbox !== selectAllCheckbox) {
                checkbox.addEventListener("change", updateSelectedCount);
            }
        });
    }

    function updateSelectedCount() {
        if (!selectedSongsCount) return;

        const checkedCount = Array.from(songCheckboxes)
            .filter(checkbox => checkbox !== selectAllCheckbox && checkbox.checked)
            .length;

        selectedSongsCount.textContent = checkedCount + " songs selected";
    }

    // Play selected song
    function playSong(songSrc, index) {
        if (!audioPlayer) return;

        console.log("Playing song:", songSrc);
        // Set the audio source
        audioPlayer.src = songSrc;

        // Play the audio and update UI
        audioPlayer.play()
            .then(() => {
                isPlaying = true;
                updatePlayerUI();
                updateSongInfo(index);
                highlightCurrentTrack(index);
            })
            .catch(err => {
                console.error("Error playing audio:", err);
                showMessage("Error playing audio: " + err.message, "error");
            });
    }

    // Play song from list index
    function playSongFromIndex(index) {
        console.log("Playing song from index:", index);
        const btn = trackPlayBtns[index];
        if (btn) {
            const songSrc = btn.getAttribute("data-src");
            if (songSrc) {
                playSong(songSrc, index);
            } else {
                showMessage("Song source not found", "error");
            }
        } else {
            showMessage("Play button not found", "error");
        }
    }

    // Toggle play/pause
    function togglePlayPause() {
        if (!audioPlayer) return;

        console.log("Toggle play/pause, current state:", audioPlayer.paused ? "paused" : "playing");

        if (audioPlayer.paused) {
            if (audioPlayer.src) {
                audioPlayer.play()
                    .then(() => {
                        isPlaying = true;
                        updatePlayerUI();
                    })
                    .catch(err => {
                        console.error("Error playing audio:", err);
                    });
            } else if (numSongs > 0) {
                // If no song is loaded, play the first one
                playSongFromIndex(0);
            }
        } else {
            audioPlayer.pause();
            isPlaying = false;
            updatePlayerUI();
        }
    }

    // Update UI to reflect current play state
    function updatePlayerUI() {
        console.log("Updating player UI, isPlaying:", isPlaying);

        if (playPauseBtn) {
            const icon = playPauseBtn.querySelector('i');
            if (icon) {
                icon.className = isPlaying ? "fas fa-pause" : "fas fa-play";
            }
        }

        if (playAllBtn) {
            const playIcon = playAllBtn.querySelector('i');
            if (playIcon) {
                playIcon.className = isPlaying ? "fas fa-pause" : "fas fa-play";
            }
            const text = playAllBtn.childNodes[1];
            if (text && text.nodeType === Node.TEXT_NODE) {
                text.nodeValue = isPlaying ? " Pause" : " Play";
            }
        }
    }

    // Update song info in the footer
{#    function updateSongInfo(index) {#}
{#        if (!tracks || tracks.length === 0 || index < 0 || index >= tracks.length) return;#}
{##}
{#        console.log("Updating song info for index:", index);#}
{##}
{#        const track = tracks[index];#}
{#        const titleElement = track.querySelector(".track-title");#}
{#        const emotionElement = track.querySelector(".track-emotion");#}
{##}
{#        const title = titleElement ? titleElement.textContent : "Unknown";#}
{#        const emotion = emotionElement ? emotionElement.textContent : "";#}
{##}
{#        if (trackTitle) trackTitle.textContent = title;#}
{#        if (trackArtist) trackArtist.textContent = emotion;#}
{##}
{#        // Also update the track cover if available#}
{#        const playlistCoverImg = document.getElementById("playlist-cover-img");#}
{#        if (trackCover && playlistCoverImg) {#}
{#            trackCover.src = playlistCoverImg.src;#}
{#        }#}
{#    }#}
        function updateSongInfo(index) {
    if (!tracks || tracks.length === 0 || index < 0 || index >= tracks.length) return;

    console.log("Updating song info for index:", index);

    const track = tracks[index];
    const titleElement = track.querySelector(".track-title");
    const emotionElement = track.querySelector(".track-emotion");
    const simageElement = track.querySelector(".track-image"); // Assuming image is in a track-image class

    const title = titleElement ? titleElement.textContent : "Unknown";
    const emotion = emotionElement ? emotionElement.textContent : "";
    const simageSrc = simageElement ? simageElement.src : ""; // Get the song image source

    if (trackTitle) trackTitle.textContent = title;
    if (trackArtist) trackArtist.textContent = emotion;

    // Update the track cover with the actual song image
    const trackCover = document.getElementById("track-cover");
    if (trackCover && simageSrc) {
        trackCover.src = simageSrc;
    }
}


    // Highlight the currently playing track
    function highlightCurrentTrack(index) {
        if (!tracks) return;

        console.log("Highlighting track:", index);

        tracks.forEach(track => {
            track.classList.remove("currently-playing");
        });

        if (index >= 0 && index < tracks.length) {
            tracks[index].classList.add("currently-playing");
        }
    }

    // Show messages to user
    function showMessage(message, type) {
        console.log("Showing message:", message, type);

        let messageDisplay = document.getElementById("message-display");

        if (!messageDisplay) {
            // Create message display element if it doesn't exist
            messageDisplay = document.createElement("div");
            messageDisplay.id = "message-display";
            document.body.appendChild(messageDisplay);

            // Add some basic styles
            messageDisplay.style.position = "fixed";
            messageDisplay.style.top = "20px";
            messageDisplay.style.left = "50%";
            messageDisplay.style.transform = "translateX(-50%)";
            messageDisplay.style.padding = "10px 20px";
            messageDisplay.style.borderRadius = "4px";
            messageDisplay.style.zIndex = "1000";
            messageDisplay.style.display = "none";
        }

        messageDisplay.textContent = message;
        messageDisplay.className = `message-display ${type}`;
        messageDisplay.style.backgroundColor = type === "error" ? "#f44336" : "#4CAF50";
        messageDisplay.style.color = "white";
        messageDisplay.style.display = "block";

        setTimeout(() => {
            messageDisplay.style.display = "none";
        }, 3000);
    }

    // Initialize with first song info if available
    if (numSongs > 0) {
        console.log("Initializing with first song info");
        updateSongInfo(0);
    }

    // Close modal when clicking outside
    window.addEventListener("click", function(event) {
        if (event.target === addSongModal) {
            addSongModal.style.display = "none";
        }
    });

    // Debug logging
    console.log("Music player initialization complete");
});</script>
</body></html>